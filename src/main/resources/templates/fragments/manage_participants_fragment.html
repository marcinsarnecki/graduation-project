<div data-th-fragment="content">
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <th:block th:replace="~{fragments/alert_message_fragment::alertMessages(${errorMessages}, ${successMessage})}"></th:block>
                <ul class="nav nav-tabs justify-content-center mb-4">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#currentParticipants">Current
                            Participants</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#addParticipant">Add Participant</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div id="currentParticipants" class="tab-pane fade show active">
                        <div class="card">
                            <div class="card-header text-center">
                                <h5 th:text="${tripName} + ' Participants'">Trip Participants</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center"
                                        th:each="participant : ${participantsPage}">
                                        <span th:text="${participant.user.username} + (${participant.user.name} != ${participant.user.username} ? ' (' + ${participant.user.name} + ')' : '')">Username</span>
                                        <form th:action="@{/trips/remove-participant/{tripId}/{participantId}(tripId=${tripId}, participantId=${participant.id})}" method="post" th:if="${!participant.user.username.equals(tripOwner)}">
                                            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
                                        </form>
                                    </li>
                                    <li class="list-group-item" th:if="${#lists.isEmpty(participantsPage)}">No participants added yet.
                                    </li>
                                </ul>

                                <nav aria-label="Page navigation" class="mt-4">
                                    <ul class="pagination justify-content-center">
                                        <li th:class="|page-item ${participantsPage.hasPrevious() ? '' : 'disabled'}|">
                                            <a class="page-link"
                                               th:href="@{|/trips/manage-participants/${tripId}?page=${participantsPage.number - 1}|}"
                                               th:if="${participantsPage.hasPrevious()}">Previous</a>
                                        </li>
                                        <li th:each="pageNum : ${#numbers.sequence(0, participantsPage.totalPages - 1)}"
                                            th:class="|page-item ${pageNum == participantsPage.number ? 'active' : ''}|">
                                            <a class="page-link"
                                               th:href="@{|/trips/manage-participants/${tripId}?page=${pageNum}|}"
                                               th:text="${pageNum + 1}"></a>
                                        </li>
                                        <li th:class="|page-item ${participantsPage.hasNext() ? '' : 'disabled'}|">
                                            <a class="page-link"
                                               th:href="@{|/trips/manage-participants/${tripId}?page=${participantsPage.number + 1}|}"
                                               th:if="${participantsPage.hasNext()}">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div id="addParticipant" class="tab-pane fade">
                        <div class="card">
                            <div class="card-header text-center">
                                <h5>Your friends</h5>
                            </div>
                            <div class="card-body">
                                <div th:if="${not #lists.isEmpty(friends)}">
                                    <form th:action="@{/trips/add-participant/{tripId}(tripId=${tripId})}" method="post" class="form-inline justify-content-center mb-3">
                                        <input id="friendInput" type="text" class="form-control mb-2 mr-sm-2"
                                               placeholder="Search and select a friend" oninput="filterFriends()" autocomplete="off"
                                               name="username" required>
                                        <button type="submit" class="btn btn-primary" disabled>Invite to the trip!</button>
                                    </form>
                                    <div class="list-container">
                                        <ul id="friendsList" class="list-group">
                                            <li th:each="friend : ${friends}" class="list-group-item"
                                                th:text="${friend.username} + ' (' + ${friend.name} + ')'">
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div th:if="${#lists.isEmpty(friends)}" class="text-center">
                                    <p>No available friends to add.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
